<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <script src="bundle.js" type="text/javascript"></script>
  </head>

  <body>
    <div id="container">
      <!-- Start your code from here -->
      <div class="thread">
        <p>
          <span class="sl">‚ú®</span> <br />
          Your threads will be here. üî• <br /><br />
          ‚ö†Ô∏è The character limit for each tweet is 275. <br /><br />
        </p>
      </div>
      <div class="info">
        <h1 style="display: inline-block">
          Characters:<span class="char_display">0</span>
        </h1>
        <h1 style="display: inline-block; margin-left: 8%">
          Threads:<span class="thread_display">0</span>
        </h1>
      </div>

      <textarea
        name="text"
        id="text"
        placeholder="The character limit for each thread is 275."
      ></textarea>

      <button class="btn" type="submit">Thread</button>

      <!-- End your code -->
    </div>

    <script type="text/javascript">
      // write your javascript code here
      const box = document.getElementById("text");
      const char_display = document.querySelector(".char_display");
      const thread_display = document.querySelector(".thread_display");
      const thread = document.querySelector(".thread");
      const btn = document.querySelector(".btn");
      const added_threads = document.querySelector(".added-threads");
      let str = box.value;
      let char_count = str.length;
      let cur_thread_count = 0;
      let total_thread_count = 0;
      box.addEventListener("input", () => {
        str = box.value;
        char_count = str.length;
        char_display.textContent = char_count;
        if (char_count % 275 == 0) {
          cur_thread_count = parseInt(char_count / 275);
        } else {
          cur_thread_count = parseInt(char_count / 275) + 1;
        }
        thread_display.textContent = cur_thread_count;
      });

      threadlist = [];
      btn.addEventListener("click", () => {
        total_thread_count += cur_thread_count;
        if (char_count == 0) {
          alert("You haven't entered any data");
        } else {
          str = str.trim();

          let start = 0;
          let end = start + 275;
          for (
            i = total_thread_count - cur_thread_count;
            i < total_thread_count;
            i++
          ) {
            temp = str.slice(start, end);
            const text = document.createElement("div");
            text.textContent = temp;
            newthread = document.createElement("div");
            newcount = document.createElement("div");
            newcount.classList.add("newcount");
            del_btn_parent = document.createElement("div");
            del_btn = document.createElement("button");
            del_btn_parent.classList.add("del-btn-parent");
            del_btn.classList.add("del-btn");
            del_btn.textContent = "DELETE";
            del_btn_parent.appendChild(del_btn);
            newcount.textContent = i + 1;
            newthread.appendChild(newcount);
            newthread.appendChild(text);
            newthread.appendChild(del_btn);
            newthread.classList.add("new-thread");
            threadlist.push(newthread);
            thread.appendChild(newthread);
            del_btn.addEventListener("click", (e) => {
              let n = parseInt(
                e.currentTarget.parentElement.firstElementChild.textContent
              );
              e.currentTarget.parentElement.remove();

              for (k = n; k < thread.children.length; k++) {
                thread.children[k].firstChild.textContent = n;
                n += 1;
              }

              total_thread_count -= 1;
            });
            box.value = "";
            char_count = 0;
            cur_thread_count = 0;
            char_display.textContent = char_count;
            thread_display.textContent = cur_thread_count;
            start = end;
            end = start + 275;
          }
        }
      });
    </script>
  </body>
  <script>
    /* DO NOT EDIT THIS CODE- WRITTERN TO PREVENT CSS CACHING */
    // Get HTML head element
    var head = document.getElementsByTagName("HEAD")[0];
    // Create new link Element
    var link = document.createElement("link");
    // set the attributes for link element
    link.rel = "stylesheet";
    link.type = "text/css";
    link.href = "./assignment6.css?v=" + new Date().getTime();
    // Append link element to HTML head
    head.appendChild(link);
    /* DO NOT EDIT THIS CODE- WRITTERN TO PREVENT CSS CACHING */
  </script>
</html>
